name: Delete jyotigpt Package

on:
  workflow_dispatch:

jobs:
  delete-packages:
    runs-on: ubuntu-latest
    steps:
      - name: Delete all versions
        run: |
          while true; do
            remaining=$(gh api "/user/packages/container/jyotigpt/versions" --paginate | jq 'length')
            echo "Versions remaining: $remaining"
            if [ "$remaining" -eq 0 ]; then
              echo "All versions deleted!"
              break
            fi
            gh api "/user/packages/container/jyotigpt/versions" | \
              jq -r '.[].id' | \
              xargs -I{} gh api --method DELETE "/user/packages/container/jyotigpt/versions/{}"
          done
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}